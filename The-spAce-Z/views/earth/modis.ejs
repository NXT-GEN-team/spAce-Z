<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MODIS Web Service</title>
  <link rel="stylesheet" href="/homepage.css">
  <style>
    body { color: #333; font-family: sans-serif; padding: 2rem; }
    .form-container { text-align: center; margin-bottom: 2rem; }
    input, select, button { margin: 0.5rem; padding: 0.5rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
    th { background: #eee; }
    .error { color: red; text-align: center; }
  </style>
</head>
<body>
  <header>
    <h1>üåø MODIS Product Subset</h1>
    <a href="/earth">‚Üê Back</a>
  </header>

  <div class="form-container">
    <form method="GET" action="/earth/modis">
      <select name="product">
        <option value="MOD09A1" <%= product === 'MOD09A1' ? 'selected' : '' %>>Surface Reflectance (8‚Äëday)</option>
        <option value="MOD13Q1" <%= product === 'MOD13Q1' ? 'selected' : '' %>>Vegetation Indices (16‚Äëday)</option>
        <option value="MOD14A1" <%= product === 'MOD14A1' ? 'selected' : '' %>>Active Fire</option>
      </select>
      <input type="number" name="lat" placeholder="Latitude" step="0.01" required value="<%= lat %>">
      <input type="number" name="lon" placeholder="Longitude" step="0.01" required value="<%= lon %>">
      <input type="date" name="date" required value="<%= date %>">
      <button type="submit">Fetch</button>
    </form>
  </div>

  <% if (error) { %>
    <p class="error"><%= error %></p>
  <% } else if (data && data.subset && data.subset.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>Band</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <% data.subset.forEach(entry => { %>
          <tr>
            <td><%= entry.band %></td>
            <td><%= entry.data.join(', ') %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else if (data) { %>
    <p style="text-align:center;">No MODIS data found for the selected date and location.</p>
  <% } else { %>
    <p style="text-align:center;">Enter your filters to fetch MODIS data.</p>
  <% } %>

  <% if (data && data.subset && data.subset.length > 0) { %>
    <h2 style="text-align:center;">üìä MODIS Data Chart</h2>
    <canvas id="modisChart" width="800" height="400" style="display:block; margin: 2rem auto;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const labels = <%= JSON.stringify(data.subset.map(s => s.band)) %>;
      const values = <%= JSON.stringify(data.subset.map(s => s.data[0])) %>;
    
      const ctx = document.getElementById('modisChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'MODIS Band Values',
            data: values,
            backgroundColor: 'rgba(0, 255, 133, 0.6)',
            borderColor: 'rgba(0, 255, 133, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    </script>
    
  <% } %>

</body>
</html>
